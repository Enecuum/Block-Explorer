<template>
  <b-container fluid class="h-100">
    <div id="loadingProgressG" v-if="preload">
      <div class="loadingProgressG"></div>
    </div>
    <template v-else>
      <b-row>
        <b-col>
          <b-container fluid class="container-wrapper">

            <b-row class="m-0 mb-20 pb-20 border-bottom-gray">

              <b-col class="d-flex pr-0 pl-0 align-items-center justify-content-center">
                <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="30px" height="33px" version="1.1" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 426564 444266">
                 <g id="Слой_x0020_1">
                  <g id="_811910480">
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M247098 41005l-38800 -22398 9968 -17278 38800 22398 0 7 -9968 17271zm9968 -17278c4768,2750 6405,8854 3655,13622 -2750,4769 -8854,6406 -13623,3656l9968 -17278zm28825 39676l-38793 -22405 9968 -17264 38793 22405 4983 8632 -14951 8632zm9968 -17264c4761,2751 6398,8855 3648,13616 -2751,4761 -8855,6398 -13616,3648l9968 -17264zm-14952 53428l0 -44796 19935 0 0 44796 0 0 -19935 0zm19935 0c0,5501 -4466,9968 -9967,9968 -5501,0 -9968,-4467 -9968,-9968l19935 0zm-19935 44797l0 -44797 19935 0 0 44797 -4983 8632 -14952 -8632zm19935 0c0,5501 -4466,9967 -9967,9967 -5501,0 -9968,-4466 -9968,-9967l19935 0zm-53744 13766l38793 -22398 9968 17264 -38793 22398 -9968 -17264zm9968 17264c-4761,2750 -10865,1113 -13616,-3648 -2750,-4761 -1113,-10865 3648,-13616l9968 17264zm-48768 5142l38800 -22406 9968 17264 -38800 22405 -9968 0 0 -17263zm9968 17263c-4761,2751 -10865,1113 -13616,-3648 -2750,-4761 -1113,-10865 3648,-13615l9968 17263zm-38793 -39669l38793 22406 -9968 17263 -38793 -22405 9968 -17271 0 7zm-9968 17264c-4761,-2751 -6398,-8855 -3648,-13616 2751,-4761 8855,-6398 13616,-3648l-9968 17264zm-28832 -39669l38800 22398 -9968 17278 -38800 -22398 -4984 -8639 14952 -8639zm-9968 17278c-4768,-2751 -6405,-8855 -3655,-13623 2750,-4768 8854,-6406 13623,-3655l-9968 17278zm14951 -53436l0 44797 -19935 0 0 -44797 0 0 19935 0zm-19935 0c0,-5500 4467,-9967 9968,-9967 5501,0 9967,4467 9967,9967l-19935 0zm19935 -44796l0 44796 -19935 0 0 -44796 4984 -8632 14951 8632zm-19935 0c0,-5501 4467,-9967 9968,-9967 5501,0 9967,4466 9967,9967l-19935 0zm53752 -13773l-38800 22405 -9968 -17264 38800 -22405 0 0 9968 17264zm-9968 -17264c4761,-2751 10865,-1113 13616,3648 2750,4761 1113,10865 -3648,13616l-9968 -17264zm48761 -5135l-38793 22399 -9968 -17264 38793 -22398 9968 -7 0 17270zm-9968 -17263c4761,-2751 10865,-1113 13616,3648 2750,4761 1113,10865 -3648,13615l-9968 -17263z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M121377 232829l-38800 -22398 9967 -17278 38800 22398 0 0 -9967 17278zm9967 -17278c4769,2751 6406,8855 3656,13623 -2751,4768 -8855,6406 -13623,3655l9967 -17278zm28833 39676l-38800 -22398 9967 -17278 38800 22398 4984 8639 -14951 8639zm9967 -17278c4769,2751 6406,8855 3656,13623 -2751,4768 -8855,6406 -13623,3655l9967 -17278zm-14951 53436l0 -44797 19935 0 0 44797 0 0 -19935 0zm19935 0c0,5501 -4467,9967 -9967,9967 -5501,0 -9968,-4466 -9968,-9967l19935 0zm-19935 44803l0 -44803 19935 0 0 44803 -4984 8639 -14951 -8639zm19935 0c0,5501 -4467,9968 -9967,9968 -5501,0 -9968,-4467 -9968,-9968l19935 0zm-53751 13760l38800 -22399 9967 17278 -38800 22399 0 0 -9967 -17278zm9967 17278c-4768,2750 -10872,1113 -13622,-3656 -2751,-4768 -1114,-10872 3655,-13622l9967 17278zm-48767 5120l38800 -22398 9967 17278 -38800 22398 -9967 -7 0 -17271zm9967 17278c-4768,2750 -10872,1113 -13622,-3655 -2751,-4769 -1114,-10873 3655,-13623l9967 17278zm-38793 -39669l38793 22398 -9967 17264 -38793 -22399 9967 -17270 0 7zm-9967 17263c-4761,-2750 -6399,-8854 -3648,-13615 2750,-4761 8854,-6399 13615,-3648l-9967 17263zm-28833 -39669l38800 22399 -9967 17278 -38800 -22399 -4984 -8639 14951 -8639zm-9967 17278c-4769,-2750 -6406,-8854 -3655,-13622 2750,-4769 8854,-6406 13622,-3656l-9967 17278zm14951 -53442l0 44803 -19935 0 0 -44803 0 0 19935 0zm-19935 0c0,-5501 4467,-9968 9968,-9968 5500,0 9967,4467 9967,9968l-19935 0zm19935 -44797l0 44797 -19935 0 0 -44797 4984 -8639 14951 8639zm-19935 0c0,-5500 4467,-9967 9968,-9967 5500,0 9967,4467 9967,9967l-19935 0zm53751 -13759l-38800 22398 -9967 -17278 38800 -22398 9967 17271 0 7zm-9967 -17278c4768,-2750 10872,-1113 13623,3655 2750,4769 1113,10873 -3656,13623l-9967 -17278zm48760 -5127l-38793 22398 -9967 -17264 38793 -22398 9967 -7 0 17271zm-9967 -17264c4761,-2750 10865,-1113 13615,3648 2751,4761 1113,10865 -3648,13616l-9967 -17264z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M305187 232829l-9967 -17271 0 -7 38800 -22398 9967 17278 -38800 22398zm-9967 -17278l9967 17278c-4768,2751 -10872,1113 -13623,-3655 -2750,-4768 -1113,-10872 3656,-13623zm-28826 39669l-14951 -8632 4984 -8631 38793 -22399 9967 17264 -38793 22398zm-9967 -17263l9967 17263c-4761,2751 -10865,1113 -13615,-3648 -2751,-4761 -1113,-10865 3648,-13615zm14951 53428l-19935 0 0 -44797 19935 0 0 44797zm-19935 0l19935 0c0,5501 -4467,9967 -9968,9967 -5500,0 -9967,-4466 -9967,-9967zm19935 44803l-14951 8632 -4984 -8632 0 -44803 19935 0 0 44803zm-19935 0l19935 0c0,5501 -4467,9968 -9968,9968 -5500,0 -9967,-4467 -9967,-9968zm53744 13767l-9967 17271 0 -8 -38793 -22398 9967 -17263 38793 22398zm-9967 17263l9967 -17263c4761,2750 6399,8854 3648,13615 -2750,4761 -8854,6399 -13615,3648zm48767 5128l0 17271 -9967 7 -38800 -22398 9967 -17278 38800 22398zm-9967 17278l9967 -17278c4768,2750 6406,8854 3655,13623 -2750,4768 -8854,6405 -13622,3655zm38793 -39669l0 -7 9967 17270 -38793 22399 -9967 -17264 38793 -22398zm9967 17263l-9967 -17263c4761,-2751 10865,-1113 13615,3648 2751,4761 1113,10865 -3648,13615zm28833 -39669l14951 8639 -4984 8639 -38800 22399 -9967 -17278 38800 -22399zm9967 17278l-9967 -17278c4768,-2750 10872,-1113 13622,3656 2751,4768 1113,10872 -3655,13622zm-14951 -53442l19935 0 0 44803 -19935 0 0 -44803zm19935 0l-19935 0c0,-5501 4467,-9968 9967,-9968 5501,0 9968,4467 9968,9968zm-19935 -44797l14951 -8639 4984 8639 0 44797 -19935 0 0 -44797zm19935 0l-19935 0c0,-5500 4467,-9967 9967,-9967 5501,0 9968,4467 9968,9967zm-53751 -13759l0 -7 9967 -17271 38800 22398 -9967 17278 -38800 -22398zm9967 -17278l-9967 17278c-4769,-2750 -6406,-8854 -3656,-13623 2751,-4768 8855,-6405 13623,-3655zm-48760 -5127l0 -17271 9967 7 38793 22398 -9967 17264 -38793 -22398zm9967 -17264l-9967 17264c-4761,-2751 -6399,-8855 -3648,-13616 2750,-4761 8854,-6398 13615,-3648z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M275514 386852c4769,-2751 10873,-1113 13623,3655 2750,4768 1113,10872 -3655,13623l-9968 -17278zm-67216 38807l67216 -38807 9968 17278 -67216 38807 -9968 0 0 -17278zm9968 17278c-4769,2750 -10873,1113 -13623,-3655 -2750,-4768 -1113,-10873 3655,-13623l9968 17278zm-67216 -56085l67216 38807 -9968 17278 -67216 -38807 9968 -17278zm-9968 17278c-4768,-2751 -6406,-8855 -3655,-13623 2750,-4768 8854,-6406 13623,-3655l-9968 17278zm-85794 -226230c0,5508 -4467,9975 -9975,9975 -5508,0 -9974,-4467 -9974,-9975l19949 0zm0 -34520l0 34520 -19949 0 0 -34520 4991 -8639 14958 8639zm-19949 0c0,-5508 4466,-9975 9974,-9975 5508,0 9975,4467 9975,9975l-19949 0zm63518 -19389l-48560 28028 -9967 -17278 48559 -28028 9968 17278zm-9968 -17278c4768,-2751 10872,-1113 13623,3655 2750,4768 1113,10872 -3655,13623l-9968 -17278zm238826 17278c-4769,-2751 -6406,-8855 -3656,-13623 2751,-4768 8855,-6406 13623,-3655l-9967 17278zm48552 28028l-48552 -28028 9967 -17278 48552 28028 4991 8639 -14958 8639zm9967 -17278c4769,2750 6406,8854 3655,13623 -2750,4768 -8854,6405 -13622,3655l9967 -17278zm-14958 43159l0 -34520 19949 0 0 34520 -19949 0zm19949 0c0,5508 -4467,9975 -9975,9975 -5508,0 -9974,-4467 -9974,-9975l19949 0z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M285891 46139c4761,-2750 10865,-1113 13616,3648 2750,4761 1113,10866 -3648,13616l-9968 -17264zm-38793 22398l38793 -22398 9968 17264 -38793 22398 0 7 -9968 -17271zm9968 17264c-4761,2751 -10865,1113 -13616,-3648 -2750,-4761 -1113,-10865 3648,-13616l9968 17264zm-48768 5127l38800 -22398 9968 17278 -38800 22398 -9968 -7 0 -17271zm9968 17278c-4769,2751 -10873,1114 -13623,-3655 -2750,-4768 -1113,-10872 3655,-13623l9968 17278zm-38793 -39669l38793 22399 -9968 17263 -38793 -22398 9968 -17271 0 7zm-9968 17264c-4761,-2750 -6398,-8854 -3648,-13615 2751,-4762 8855,-6399 13616,-3649l-9968 17264zm-28832 -39669l38800 22398 -9968 17278 -38800 -22398 9968 -17278zm-9968 17278c-4768,-2750 -6405,-8854 -3655,-13623 2750,-4768 8854,-6405 13623,-3655l-9968 17278z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M160177 237949c4768,-2750 10872,-1113 13623,3656 2750,4768 1113,10872 -3656,13622l-9967 -17278zm-38800 22399l38800 -22399 9967 17278 -38800 22399 0 0 -9967 -17278zm9967 17278c-4768,2750 -10872,1113 -13622,-3656 -2751,-4768 -1114,-10872 3655,-13622l9967 17278zm-48767 5120l38800 -22398 9967 17278 -38800 22398 -9967 -7 0 -17271zm9967 17278c-4768,2750 -10872,1113 -13622,-3655 -2751,-4769 -1114,-10873 3655,-13623l9967 17278zm-38793 -39669l38793 22398 -9967 17264 -38793 -22399 9967 -17270 0 7zm-9967 17263c-4761,-2750 -6399,-8854 -3648,-13615 2750,-4761 8854,-6399 13615,-3648l-9967 17263zm-28833 -39669l38800 22399 -9967 17278 -38800 -22399 9967 -17278zm-9967 17278c-4769,-2750 -6406,-8854 -3655,-13622 2750,-4769 8854,-6406 13622,-3656l-9967 17278z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M266394 237957l-9967 17263c-4761,-2750 -6399,-8854 -3648,-13615 2750,-4761 8854,-6399 13615,-3648zm38793 22398l-9967 17271 0 -8 -38793 -22398 9967 -17263 38793 22398zm-9967 17263l9967 -17263c4761,2750 6399,8854 3648,13615 -2750,4762 -8854,6399 -13615,3648zm48767 5128l0 17271 -9967 7 -38800 -22398 9967 -17278 38800 22398zm-9967 17278l9967 -17278c4768,2750 6406,8854 3655,13623 -2750,4768 -8854,6405 -13622,3655zm38793 -39669l0 -7 9967 17270 -38793 22399 -9967 -17264 38793 -22398zm9967 17263l-9967 -17263c4761,-2751 10865,-1113 13615,3648 2751,4761 1113,10865 -3648,13615zm28833 -39669l9967 17278 -38800 22399 -9967 -17278 38800 -22399zm9967 17278l-9967 -17278c4768,-2750 10872,-1113 13622,3656 2751,4768 1113,10872 -3655,13622z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M203314 99567c0,-5500 4467,-9967 9968,-9967 5501,0 9967,4467 9967,9967l-19935 0zm0 89600l0 -89600 19935 0 0 89600 -19935 0zm19935 0c0,5501 -4466,9968 -9967,9968 -5501,0 -9968,-4467 -9968,-9968l19935 0z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M77593 291385c0,-5501 4467,-9968 9968,-9968 5500,0 9967,4467 9967,9968l-19935 0zm0 89600l0 -89600 19935 0 0 89600 -19935 0zm19935 0c0,5501 -4467,9967 -9967,9967 -5501,0 -9968,-4466 -9968,-9967l19935 0z"/>
                   </g>
                   <g>
                    <path fill="#00ADD9" fill-rule="nonzero" d="M348971 291385l-19935 0c0,-5501 4467,-9968 9967,-9968 5501,0 9968,4467 9968,9968zm0 89600l-19935 0 0 -89600 19935 0 0 89600zm-19935 0l19935 0c0,5501 -4467,9967 -9968,9967 -5500,0 -9967,-4466 -9967,-9967z"/>
                   </g>
                  </g>
                 </g>
                </svg>
                <h1 class="weight-600 m-0">
                  {{ $t('explorer.blocks.title') }}
                </h1>
              </b-col>

            </b-row>

            <b-row>
              <b-col>
                <b-table striped hover responsive :items="items" :fields="fields">

                  <template slot="hash" slot-scope="data">
                    <router-link class="href td-hash-wrapper" :to="{name: 'Block', params: {id: data.item.hash}}">
                      {{ data.item.hash }}
                    </router-link>
                  </template>

                  <template slot="prev_hash" slot-scope="data">
                    <router-link class="href td-hash-wrapper" :to="{name: 'Block', params: {id: data.item.prev_hash}}">
                      {{ data.item.prev_hash }}
                    </router-link>
                  </template>

                  <template slot="solver" slot-scope="data">
                    <router-link class="href td-hash-wrapper" :to="{name: 'Wallet', params: {id: data.item.solver}}">
                      {{ data.item.solver }}
                    </router-link>
                  </template>

                </b-table>

                <b-pagination class="mt-10 weight-600"
                              align="center"
                              @change="turnPage"
                              :total-rows="total"
                              :per-page="perPage"
                              v-model="currentPage">
                </b-pagination>
              </b-col>
            </b-row>
          </b-container>

        </b-col>
      </b-row>
    </template>
  </b-container>

</template>

<script>
  import _ from "lodash"

  export default {
    name: 'Explorer',
    data() {
      return {
        currentPage: 1,
        preload: true,
        perPage: 25,
        total: 0,
        items: [],
        fields: [
          {key: 'number', label: this.$i18n.t('explorer.blocks.height'), tdClass: 'weight-600'},
          {key: 'hash', label: this.$i18n.t('explorer.blocks.hash'), tdClass: 'weight-600'},
          {key: 'microblocks', label: this.$i18n.t('explorer.blocks.microblocks'), tdClass: 'weight-600 '},
          {key: 'prev_hash', label: this.$i18n.t('explorer.blocks.prev'), tdClass: 'weight-600'},
          {key: 'nonce', label: this.$i18n.t('explorer.blocks.prev'), tdClass: 'weight-600'},
          {key: 'solver', label: this.$i18n.t('explorer.blocks.miner'), tdClass: 'weight-600'},
        ],
      }
    },
    watch: {
      '$route': 'load'
    },
    methods: {
      load(page) {
        if (this.$root.ws.ready) {
          this.fetchData(page)
        } else {
          setTimeout(() => {
            this.load(page)
          }, 500)
        }
      },

      turnPage(page) {
        this.$router.push({name: 'ExplorerPage', params: {id: page}});
        this.preload = true
      },

      fetchData(page = 1) {
        this.$root.ws.call('getKBlockList', {page: parseInt(page), limit: this.perPage}).then(r => {
          _.assign(this.$data, _.pick(r, _.keys(this.$data)));
          this.currentPage = parseInt(page);
          this.preload = false
        });
      }
    },

    created() {
      this.load(this.$route.params.id);
    }
  }
</script>
